import{c as d,o,a as e,r as v,b as A,d as D,w as N,f as g,v as p,H,A as z,B as F,u as n,C as R,t as u,F as b,e as C,_ as S,y as T,g as Z,h as E,k as Q}from"./BxfpjSiT.js";import{u as U}from"./Cx6aenjR.js";import{r as q}from"./vbYhx-_b.js";import{r as G}from"./BSLA1L1h.js";import{r as I}from"./D37AenBN.js";function w(h,c){return o(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function J(h,c){return o(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})])}function K(h,c){return o(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"})])}function L(h,c){return o(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])}const O={class:"space-y-6"},P={class:"flex justify-between items-center"},W={class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6"},X={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Y={key:0,class:"text-center py-12"},ee={key:1,class:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 rounded-md p-4"},re={class:"flex"},se={class:"ml-3"},te={class:"text-sm font-medium text-red-800 dark:text-red-200"},ae={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},oe={class:"flex justify-between items-start mb-4"},de={class:"text-lg font-semibold text-gray-900 dark:text-white"},ne={class:"text-sm text-gray-500 dark:text-gray-400"},ie={class:"flex space-x-2"},le={class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 p-1"},ue=["onClick","disabled"],me={class:"space-y-2 mb-4"},xe={class:"space-y-1"},ce={class:"text-gray-600 dark:text-gray-300"},ge={class:"text-gray-900 dark:text-white"},pe={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200"},he={class:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700"},ye={class:"text-sm text-gray-500 dark:text-gray-400"},ve={key:0,class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},fe={class:"text-sm text-gray-600 dark:text-gray-300"},ke={key:3,class:"text-center py-12"},we={class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},_e={class:"text-gray-500 dark:text-gray-400"},Me={__name:"index",setup(h){const{getClients:c,deleteClient:V}=U(),m=v([]),i=v(""),y=v(!1),x=v(null),_=A(()=>i.value?m.value.filter(a=>a.name.toLowerCase().includes(i.value.toLowerCase())||a.how_we_met.toLowerCase().includes(i.value.toLowerCase())||a.notes&&a.notes.toLowerCase().includes(i.value.toLowerCase())):m.value),f=async()=>{var a;y.value=!0,x.value=null;try{const s=await c({search:i.value});if(s.success&&s.data){const l=s.data;l.success&&l.data&&l.data.data?m.value=l.data.data||[]:(m.value=[],x.value=l.message||"載入業主資料失敗：格式錯誤")}else m.value=[],x.value=((a=s.error)==null?void 0:a.message)||"載入業主資料失敗"}catch(s){console.error("Load clients error:",s),m.value=[],x.value="載入業主資料時發生錯誤，請稍後再試"}finally{y.value=!1}},B=()=>{i.value="",f()},M=async a=>{var s,l,r;if(!a){alert("無效的業主ID");return}if(confirm("確定要刪除此業主嗎？此操作無法復原。"))try{const t=await V(a);if(t.success){m.value=m.value.filter($=>$.id!==a);const k=((s=t.data)==null?void 0:s.message)||"業主刪除成功";alert(k)}else{const k=((l=t.error)==null?void 0:l.message)||((r=t.data)==null?void 0:r.message)||"刪除失敗";alert(k)}}catch(t){console.error("Delete client error:",t),alert("刪除業主時發生錯誤，請稍後再試")}},j=a=>({phone:L,email:K,line:w,wechat:w,telegram:w,mobile:J})[a]||L;return D(()=>{f()}),N(i,()=>{}),(a,s)=>{const l=S;return o(),d("div",O,[e("div",P,[s[2]||(s[2]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"業主管理"),e("p",{class:"text-gray-600 dark:text-gray-300"},"管理所有業主資訊和聯繫方式")],-1)),p(l,{to:"/clients/create",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},{default:H(()=>[p(n(q),{class:"w-4 h-4 mr-2"}),s[1]||(s[1]=T(" 新增業主 "))]),_:1,__:[1]})]),e("div",W,[e("div",X,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"搜尋業主",-1)),z(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>R(i)?i.value=r:null),type:"text",placeholder:"搜尋業主名稱...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},null,512),[[F,n(i)]])]),e("div",{class:"flex items-end"},[e("button",{onClick:B,class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 清除搜尋 ")])])]),n(y)?(o(),d("div",Y,s[4]||(s[4]=[e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"載入中...")],-1),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"正在載入業主資料...",-1)]))):n(x)?(o(),d("div",ee,[e("div",re,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",se,[e("p",te,u(n(x)),1),e("button",{onClick:f,class:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 underline"}," 重新載入 ")])])])):(o(),d("div",ae,[a.client?(o(!0),d(b,{key:0},C(n(_),r=>(o(),d("div",{key:(r==null?void 0:r.id)||"empty",class:"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm p-6 hover:shadow-md transition-shadow duration-200"},[e("div",oe,[e("div",null,[e("h3",de,u((r==null?void 0:r.name)||"未知業主"),1),e("p",ne," 認識於 "+u((r==null?void 0:r.how_we_met)||"未記錄"),1)]),e("div",ie,[e("button",le,[p(n(G),{class:"w-4 h-4"})]),e("button",{onClick:t=>M(r==null?void 0:r.id),class:"text-red-600 hover:text-red-900 dark:text-red-400 p-1",disabled:!(r!=null&&r.id)},[p(n(I),{class:"w-4 h-4"})],8,ue)])]),e("div",me,[s[6]||(s[6]=e("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聯繫方式",-1)),e("div",xe,[a.contact?(o(!0),d(b,{key:0},C((r==null?void 0:r.contacts)||[],t=>(o(),d("div",{key:(t==null?void 0:t.id)||"empty",class:"flex items-center space-x-2 text-sm"},[(o(),Z(E(j(t==null?void 0:t.type)),{class:"w-4 h-4 text-gray-400"})),e("span",ce,u((t==null?void 0:t.type)||"未知")+":",1),e("span",ge,u((t==null?void 0:t.value)||"未填寫"),1),t!=null&&t.is_primary?(o(),d("span",pe," 主要 ")):g("",!0)]))),128)):g("",!0)])]),e("div",he,[e("span",ye," 相關專案: "+u((r==null?void 0:r.projects_count)||0)+" 個 ",1),s[7]||(s[7]=e("button",{class:"text-sm text-primary-600 hover:text-primary-900 dark:text-primary-400"}," 查看專案 ",-1))]),r!=null&&r.notes?(o(),d("div",ve,[s[8]||(s[8]=e("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"備註",-1)),e("p",fe,u(r.notes),1)])):g("",!0)]))),128)):g("",!0)])),!n(y)&&!n(x)&&n(_).length===0?(o(),d("div",ke,[p(n(Q),{class:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e("h3",we,u(n(i)?"找不到符合條件的業主":"尚未新增任何業主"),1),e("p",_e,u(n(i)?"請嘗試其他搜尋條件":"開始建立您的第一個業主資料"),1)])):g("",!0)])}}};export{Me as default};
