{"version":3,"file":"create-D9VUJMRF.js","sources":["../../../../pages/clients/create.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <!-- Header -->\r\n    <div class=\"flex items-center space-x-4\">\r\n      <button\r\n        @click=\"$router.back()\"\r\n        class=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n      >\r\n        <ArrowLeftIcon class=\"w-5 h-5\" />\r\n      </button>\r\n      <div>\r\n        <h1 class=\"text-2xl font-bold text-gray-900 dark:text-white\">新增業主</h1>\r\n        <p class=\"text-gray-600 dark:text-gray-300\">建立新的業主資料</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Form -->\r\n    <div class=\"bg-white dark:bg-gray-800 rounded-lg-custom shadow-sm\">\r\n      <form @submit.prevent=\"submitForm\" class=\"p-6 space-y-6\">\r\n        <!-- 基本資訊 -->\r\n        <div>\r\n          <h3 class=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">基本資訊</h3>\r\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <label for=\"name\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                業主稱呼 <span class=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                id=\"name\"\r\n                v-model=\"form.name\"\r\n                type=\"text\"\r\n                required\r\n                class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                placeholder=\"請輸入業主稱呼\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label for=\"how_we_met\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                認識方式\r\n              </label>\r\n              <input\r\n                id=\"how_we_met\"\r\n                v-model=\"form.how_we_met\"\r\n                type=\"text\"\r\n                class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                placeholder=\"例如：朋友介紹、網路接洽...\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 備註 -->\r\n        <div>\r\n          <label for=\"notes\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n            備註\r\n          </label>\r\n          <textarea\r\n            id=\"notes\"\r\n            v-model=\"form.notes\"\r\n            rows=\"3\"\r\n            class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n            placeholder=\"關於這個業主的其他資訊...\"\r\n          />\r\n        </div>\r\n\r\n        <!-- 聯繫方式 -->\r\n        <div>\r\n          <div class=\"flex justify-between items-center mb-4\">\r\n            <h3 class=\"text-lg font-medium text-gray-900 dark:text-white\">聯繫方式</h3>\r\n            <button\r\n              type=\"button\"\r\n              @click=\"addContact\"\r\n              class=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-900 dark:text-primary-200\"\r\n            >\r\n              <PlusIcon class=\"w-4 h-4 mr-1\" />\r\n              新增聯繫方式\r\n            </button>\r\n          </div>\r\n\r\n          <div class=\"space-y-4\">\r\n            <div\r\n              v-for=\"(contact, index) in form.contacts\"\r\n              :key=\"contact?.id || `contact-${index}`\"\r\n              class=\"flex items-end space-x-4 p-4 border border-gray-200 dark:border-gray-600 rounded-lg\"\r\n            >\r\n              <div class=\"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    聯繫方式類型\r\n                  </label>\r\n                  <select\r\n                    v-model=\"contact.type\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                  >\r\n                    <option value=\"phone\">電話</option>\r\n                    <option value=\"mobile\">手機</option>\r\n                    <option value=\"email\">Email</option>\r\n                    <option value=\"line\">LINE</option>\r\n                    <option value=\"wechat\">WeChat</option>\r\n                    <option value=\"telegram\">Telegram</option>\r\n                    <option value=\"other\">其他</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    聯繫資訊\r\n                  </label>\r\n                  <input\r\n                    v-model=\"contact.value\"\r\n                    type=\"text\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                    :placeholder=\"getContactPlaceholder(contact.type)\"\r\n                  />\r\n                </div>\r\n                <div class=\"flex items-center\">\r\n                  <label class=\"flex items-center\">\r\n                    <input\r\n                      v-model=\"contact.is_primary\"\r\n                      type=\"checkbox\"\r\n                      @change=\"updatePrimaryContact(index)\"\r\n                      class=\"rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50\"\r\n                    />\r\n                    <span class=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">設為主要</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                @click=\"removeContact(index)\"\r\n                class=\"p-2 text-red-600 hover:text-red-900 dark:text-red-400\"\r\n              >\r\n                <TrashIcon class=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n            \r\n            <div v-if=\"form.contacts.length === 0\" class=\"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg\">\r\n              <p class=\"text-gray-500 dark:text-gray-400\">尚未新增任何聯繫方式</p>\r\n              <button\r\n                type=\"button\"\r\n                @click=\"addContact\"\r\n                class=\"mt-2 text-primary-600 hover:text-primary-500 dark:text-primary-400\"\r\n              >\r\n                點擊新增第一個聯繫方式\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 提交按鈕 -->\r\n        <div class=\"flex justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700\">\r\n          <button\r\n            type=\"button\"\r\n            @click=\"$router.back()\"\r\n            class=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\r\n          >\r\n            取消\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            :disabled=\"isSubmitting\"\r\n            class=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <span v-if=\"isSubmitting\">儲存中...</span>\r\n            <span v-else>儲存業主</span>\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n// Page metadata\r\ndefinePageMeta({\r\n  middleware: 'auth'\r\n})\r\nimport { ArrowLeftIcon, PlusIcon, TrashIcon } from '@heroicons/vue/24/outline'\r\n\r\nconst form = reactive({\r\n  name: '',\r\n  how_we_met: '',\r\n  notes: '',\r\n  contacts: []\r\n})\r\n\r\nconst isSubmitting = ref(false)\r\nlet contactIdCounter = 1\r\n\r\nconst addContact = () => {\r\n  const newContact = {\r\n    id: contactIdCounter++,\r\n    type: 'phone',\r\n    value: '',\r\n    is_primary: form.contacts.length === 0\r\n  }\r\n  form.contacts.push(newContact)\r\n  console.log('Added contact:', newContact, 'Total contacts:', form.contacts.length)\r\n}\r\n\r\nconst removeContact = (index) => {\r\n  const wasPrimary = form.contacts[index].is_primary\r\n  form.contacts.splice(index, 1)\r\n  \r\n  // 如果刪除的是主要聯繫方式，將第一個設為主要\r\n  if (wasPrimary && form.contacts.length > 0) {\r\n    form.contacts[0].is_primary = true\r\n  }\r\n}\r\n\r\nconst updatePrimaryContact = (index) => {\r\n  if (form.contacts[index].is_primary) {\r\n    // 將其他聯繫方式設為非主要\r\n    form.contacts.forEach((contact, i) => {\r\n      if (i !== index) {\r\n        contact.is_primary = false\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nconst getContactPlaceholder = (type) => {\r\n  const placeholders = {\r\n    phone: '02-1234-5678',\r\n    mobile: '0912-345-678',\r\n    email: 'example@email.com',\r\n    line: 'LINE ID',\r\n    wechat: 'WeChat ID',\r\n    telegram: 'Telegram ID',\r\n    other: '其他聯繫資訊'\r\n  }\r\n  return placeholders[type] || '請輸入聯繫資訊'\r\n}\r\n\r\nconst { createClient } = useClients()\r\n\r\nconst submitForm = async () => {\r\n  try {\r\n    isSubmitting.value = true\r\n    \r\n    // 驗證表單\r\n    if (!form.name.trim()) {\r\n      alert('請輸入業主稱呼')\r\n      return\r\n    }\r\n    \r\n    // 呼叫 API 來儲存業主資料\r\n    const response = await createClient(form)\r\n    \r\n    if (response.success) {\r\n      // 成功後導向業主列表\r\n      await navigateTo('/clients')\r\n    } else {\r\n      alert(response.error?.message || '儲存業主失敗')\r\n    }\r\n  } catch (error) {\r\n    console.error('儲存業主失敗:', error)\r\n    alert('儲存業主失敗，請稍後再試')\r\n  } finally {\r\n    isSubmitting.value = false\r\n  }\r\n}\r\n\r\n// 初始化時添加一個預設聯繫方式\r\nonMounted(() => {\r\n  addContact()\r\n})\r\n</script>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","_unref","_ssrRenderAttr","_ssrInterpolate","_ssrRenderList","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAkLA,UAAM,OAAO,SAAS;AAAA,MACpB,MAAM;AAAA,MACN,YAAY;AAAA,MACZ,OAAO;AAAA,MACP,UAAU,CAAA;AAAA,IACZ,CAAC;AAED,UAAM,eAAe,IAAI,KAAK;AAmC9B,UAAM,wBAAwB,CAAC,SAAS;AACtC,YAAM,eAAe;AAAA,QACnB,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,OAAO;AAAA,MACX;AACE,aAAO,aAAa,IAAI,KAAK;AAAA,IAC/B;AAEyB,eAAU;;AAxO5B,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAM,eAAW,MAAA,CAAA,CAAA,2HAAA;AAOD,YAAAC,mBAAAC,MAAA,aAAA,GAAA,EAAA,OAAM,UAAS,GAAA,MAAA,OAAA,CAAA;0iBAqBbC,cAAA,SAAAD,MAAA,IAAA,EAAK,IAAI,6XAaTC,cAAA,SAAAD,MAAA,IAAA,EAAK,UAAU,omBAgBnBE,eAAAF,MAAA,IAAA,EAAK,KAAK;AAgBP,YAAAD,mBAAAC,MAAA,QAAA,GAAA,EAAA,OAAM,eAAc,GAAA,MAAA,OAAA,CAAA;;AAOHG,oBAAAH,MAAA,IAAA,EAAK,UAAQ,CAAhC,SAAS,UAAK;2eAUPI,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,OAAA,IAAZC,cAAA,QAAQ,MAAI,OAAA,CAAA,IAAA,cAAA,uCAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,QAAA,IAAZC,cAAA,QAAQ,MAAI,QAAA,CAAA,IAAA,cAAA,sCAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,OAAA,IAAZC,cAAA,QAAQ,MAAI,OAAA,CAAA,IAAA,cAAA,wCAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,MAAA,IAAZC,cAAA,QAAQ,MAAI,MAAA,CAAA,IAAA,cAAA,yCAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,QAAA,IAAZC,cAAA,QAAQ,MAAI,QAAA,CAAA,IAAA,cAAA,6CAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,UAAA,IAAZC,cAAA,QAAQ,MAAI,UAAA,CAAA,IAAA,cAAA,4CAAZF,sBAAA,MAAA,QAAA,QAAQ,IAAI,IAAZC,gBAAA,QAAQ,MAAI,OAAA,IAAZC,cAAA,QAAQ,MAAI,OAAA,CAAA,IAAA,cAAA,wIAiBZL,cAAA,SAAA,QAAQ,KAAK,8MAGrBA,cAAA,eAAa,sBAAsB,QAAQ,IAAI,CAAA,iFAMrCG,sBAAA,MAAA,QAAA,QAAQ,UAAU,IAAlBC,gBAAA,QAAQ,YAAU,IAAA,IAAlB,QAAQ,UAAU,IAAA,aAAA;AActB,cAAAN,mBAAAC,MAAA,SAAA,GAAA,EAAA,OAAM,UAAS,GAAA,MAAA,OAAA,CAAA;;;;UAInBA,MAAA,IAAA,EAAK,SAAS,WAAM,GAAA;;;;;ydAwBpBA,MAAA,YAAA,CAAY,IAAA,cAAA,EAAA,kQAAA;UAGXA,MAAA,YAAA,GAAY;;;;;;;;;;;;;;;"}